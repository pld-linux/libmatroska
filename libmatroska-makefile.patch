--- libmatroska-0.7.5/make/linux/Makefile.orig	2005-02-06 19:12:08.000000000 +0100
+++ libmatroska-0.7.5/make/linux/Makefile	2005-02-27 20:16:53.467608880 +0100
@@ -28,6 +28,7 @@
 INSTALL_OPTS = -m 644
 INSTALL_OPTS_LIB = -m 644
 INSTALL_DIR_OPTS = -m 755
+LIBTOOL = libtool
 
 ifneq (,$(shell $(CXX) -v 2>&1 | tail -n 1 | grep -i mingw))
 $(error Please use the Makefile in ../mingw32)
@@ -36,8 +37,8 @@
 CWD=$(shell pwd)
 
 # Options
-LIBEBML_INCLUDE_DIR=$(CWD)/../../../libebml
-LIBEBML_LIB_DIR=$(CWD)/../../../libebml/make/linux
+LIBEBML_INCLUDE_DIR=
+LIBEBML_LIB_DIR=
 EXTENSION=.cpp
 
 ifeq (yes,$(DEBUG))
@@ -52,10 +53,10 @@
 # Librarires
 INCLUDE=-I$(CWD)/../.. -I$(LIBEBML_INCLUDE_DIR)
 LIBS=
-MUX_LIBS=-lmatroska -lebml $(LIBICONV)
+MUX_LIBS=libmatroska.la -lebml $(LIBICONV)
 
 # Names
-LIBRARY=libmatroska.a
+LIBRARY=libmatroska.la
 
 # source-files
 sources:=$(wildcard ${SRC_DIR}*$(EXTENSION))
@@ -63,8 +64,8 @@
 # header files; replace .cxx extension with .h
 headers:=$(patsubst %$(EXTENSION),%.h,$(sources))
 
-# object files; replace .cxx extension with .o
-objects:=$(patsubst %$(EXTENSION),%.o,$(sources))
+# object files; replace .cxx extension with .lo
+objects:=$(patsubst %$(EXTENSION),%.lo,$(sources))
 
 WARNINGFLAGS=-Wall -Wno-unknown-pragmas -ansi -fno-gnu-keywords -D_GNU_SOURCE \
 		-Wshadow
@@ -77,12 +78,11 @@
 lib library: $(LIBRARY)
 
 # Build rules
-%.o: %$(EXTENSION)
-	$(CXX) -c $(COMPILEFLAGS) -o $@ $<
+%.lo: %$(EXTENSION)
+	$(LIBTOOL) --mode=compile $(CXX) -c $(CXXFLAGS) $(INCLUDE) -o $@ $<
 
 $(LIBRARY): $(objects)
-	$(AR) $@ $(objects)
-	$(RANLIB) $@
+	$(LIBTOOL) --mode=link $(LD) $(LDFLAGS) -o $@ $^ $(LIBS) -lebml -rpath $(libdir)
 
 clean:	cleantest
 	rm -f $(objects)
@@ -108,33 +108,33 @@
 test: test6 test9
 
 test6:	test6.o $(LIBRARY)
-	$(LD) -o $@ $(LINKFLAGS) $< $(MUX_LIBS)
+	$(LIBTOOL) --mode=link $(LD) -o $@ $(LDFLAGS) $< $(MUX_LIBS)
 
 test6.o: $(MUX_SRC_DIR)test6.cpp
 	$(CXX) -c $(COMPILEFLAGS) -o $@ $<
 
 test8:	test8.o $(LIBRARY)
-	$(LD) -o $@ $(LINKFLAGS) $< $(MUX_LIBS)
+	$(LIBTOOL) --mode=link $(LD) -o $@ $(LDFLAGS) $< $(MUX_LIBS)
 
 test8.o: $(MUX_SRC_DIR)test8.cpp
 	$(CXX) -c $(COMPILEFLAGS) -o $@ $<
 
 test9:	test9.o $(LIBRARY)
-	$(LD) -o $@ $(LINKFLAGS) $< $(MUX_LIBS)
+	$(LIBTOOL) --mode=link $(LD) -o $@ $(LDFLAGS) $< $(MUX_LIBS)
 
 test9.o: $(TAG_SRC_DIR)test9.cpp
 	$(CXX) -c $(COMPILEFLAGS) -o $@ $<
 
 install: $(LIBRARY)
-	$(INSTALL) $(INSTALL_DIR_OPTS) -d $(libdir)
-	$(INSTALL) $(INSTALL_OPTS_LIB) $(LIBRARY) $(libdir)
-	$(INSTALL) $(INSTALL_DIR_OPTS) -d $(includedir)
+	$(INSTALL) $(INSTALL_DIR_OPTS) -d $(DESTDIR)$(libdir)
+	$(LIBTOOL) --mode=install $(INSTALL) $(LIBRARY) $(DESTDIR)$(libdir)
+	$(INSTALL) $(INSTALL_DIR_OPTS) -d $(DESTDIR)$(includedir)
 	for i in $(INCLUDE_DIR)/*.h; do \
-		$(INSTALL) $(INSTALL_OPTS) $$i $(includedir) ; \
+		$(INSTALL) $(INSTALL_OPTS) $$i $(DESTDIR)$(includedir) ; \
 	done
-	$(INSTALL) $(INSTALL_DIR_OPTS) -d $(includedir)/c
+	$(INSTALL) $(INSTALL_DIR_OPTS) -d $(DESTDIR)$(includedir)/c
 	for i in $(INCLUDE_DIR)/c/*.h; do \
-		$(INSTALL) $(INSTALL_OPTS) $$i $(includedir)/c ; \
+		$(INSTALL) $(INSTALL_OPTS) $$i $(DESTDIR)$(includedir)/c ; \
 	done
 
 ifneq ($(wildcard .depend),)
